{% extends "base.html" %}

{% block title %}Project Templates - BBSchedule Platform{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Templates Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-layer-group me-2"></i>
                        Project Templates
                    </h1>
                    <p class="text-muted mb-0">Start your construction projects with proven templates</p>
                </div>
                <div>
                    <a href="{{ url_for('projects.create') }}" class="btn btn-outline-primary">
                        <i class="fas fa-plus me-2"></i>Custom Project
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Categories -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-secondary active" data-category="all">All Templates</button>
                <button class="btn btn-outline-secondary" data-category="commercial">Commercial</button>
                <button class="btn btn-outline-secondary" data-category="residential">Residential</button>
                <button class="btn btn-outline-secondary" data-category="industrial">Industrial</button>
                <button class="btn btn-outline-secondary" data-category="infrastructure">Infrastructure</button>
                <button class="btn btn-outline-secondary" data-category="healthcare">Healthcare</button>
            </div>
        </div>
    </div>

    <!-- Template Grid -->
    <div class="row g-4">
        {% for template in templates %}
        <div class="col-lg-4 col-md-6" data-category="{{ template.category.lower() }}">
            <div class="card template-card h-100">
                <div class="card-header bg-{{ 'primary' if template.category == 'Commercial' else 'success' if template.category == 'Residential' else 'warning' if template.category == 'Industrial' else 'info' if template.category == 'Infrastructure' else 'danger' }} text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-white text-{{ 'primary' if template.category == 'Commercial' else 'success' if template.category == 'Residential' else 'warning' if template.category == 'Industrial' else 'info' if template.category == 'Infrastructure' else 'danger' }}">
                                {{ template.category }}
                            </span>
                        </div>
                        <div>
                            <i class="fas fa-{{ 'building' if template.category == 'Commercial' else 'home' if template.category == 'Residential' else 'industry' if template.category == 'Industrial' else 'road' if template.category == 'Infrastructure' else 'hospital-alt' }} fa-lg"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <h5 class="card-title">{{ template.name }}</h5>
                    <p class="card-text text-muted">{{ template.description }}</p>
                    
                    <div class="template-metrics mb-3">
                        <div class="row g-2">
                            <div class="col-6">
                                <div class="metric-item">
                                    <div class="metric-icon">
                                        <i class="fas fa-calendar text-primary"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-value">{{ template.duration_weeks }}w</div>
                                        <div class="metric-label">Duration</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="metric-item">
                                    <div class="metric-icon">
                                        <i class="fas fa-tasks text-success"></i>
                                    </div>
                                    <div class="metric-content">
                                        <div class="metric-value">{{ template.tasks_count }}</div>
                                        <div class="metric-label">Tasks</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-features mb-3">
                        <small class="text-muted">
                            <i class="fas fa-check text-success me-1"></i>Pre-defined phases
                            <br>
                            <i class="fas fa-check text-success me-1"></i>Task dependencies
                            <br>
                            <i class="fas fa-check text-success me-1"></i>Resource planning
                        </small>
                    </div>
                </div>
                
                <div class="card-footer bg-transparent">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('project_templates.template_preview', template_id=template.id) }}" 
                           class="btn btn-outline-primary">
                            <i class="fas fa-eye me-2"></i>Preview
                        </a>
                        <a href="{{ url_for('project_templates.create_from_template', template_id=template.id) }}" 
                           class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Use Template
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Quick Start Guide -->
    <div class="row mt-5">
        <div class="col">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-rocket me-2"></i>
                        Quick Start Guide
                    </h5>
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="text-center">
                                <div class="step-icon mb-2">
                                    <i class="fas fa-search fa-2x text-primary"></i>
                                </div>
                                <h6>1. Browse Templates</h6>
                                <p class="small text-muted">Choose from industry-specific project templates</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <div class="step-icon mb-2">
                                    <i class="fas fa-eye fa-2x text-info"></i>
                                </div>
                                <h6>2. Preview Details</h6>
                                <p class="small text-muted">Review tasks, timeline, and project structure</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <div class="step-icon mb-2">
                                    <i class="fas fa-edit fa-2x text-warning"></i>
                                </div>
                                <h6>3. Customize</h6>
                                <p class="small text-muted">Adjust project details, dates, and requirements</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <div class="step-icon mb-2">
                                    <i class="fas fa-play fa-2x text-success"></i>
                                </div>
                                <h6>4. Start Project</h6>
                                <p class="small text-muted">Launch your project with complete task structure</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Benefits Section -->
    <div class="row mt-4">
        <div class="col">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-star me-2"></i>
                        Benefits of Using Templates
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="benefit-item">
                                <i class="fas fa-clock text-primary me-2"></i>
                                <strong>Save 70% Setup Time</strong>
                                <p class="small mb-0">Pre-configured tasks and dependencies eliminate manual setup</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="benefit-item">
                                <i class="fas fa-shield-alt text-success me-2"></i>
                                <strong>Proven Best Practices</strong>
                                <p class="small mb-0">Based on successful construction project methodologies</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="benefit-item">
                                <i class="fas fa-chart-line text-info me-2"></i>
                                <strong>Improved Success Rate</strong>
                                <p class="small mb-0">Standardized approach reduces project risks and delays</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Category filtering
    const categoryButtons = document.querySelectorAll('[data-category]');
    const templateCards = document.querySelectorAll('[data-category]');
    
    categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // Update active button
            categoryButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Filter templates
            templateCards.forEach(card => {
                if (card.tagName === 'BUTTON') return; // Skip button elements
                
                if (category === 'all' || card.dataset.category === category.toLowerCase()) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
    
    // Template card hover effects
    document.querySelectorAll('.template-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
    
    // Load template analytics
    loadTemplateAnalytics();
});

async function loadTemplateAnalytics() {
    try {
        const response = await fetch('/project-templates/api/templates');
        const templates = await response.json();
        
        // Update template cards with real-time data
        templates.forEach(template => {
            const card = document.querySelector(`[data-template-id="${template.id}"]`);
            if (card) {
                // Update any dynamic content
                console.log('Template data loaded:', template);
            }
        });
        
    } catch (error) {
        console.error('Failed to load template analytics:', error);
    }
}
</script>

<style>
.template-card {
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.template-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.metric-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.metric-icon {
    width: 24px;
    text-align: center;
}

.metric-content {
    flex: 1;
}

.metric-value {
    font-weight: 600;
    font-size: 0.9rem;
}

.metric-label {
    font-size: 0.7rem;
    color: #6c757d;
    line-height: 1;
}

.benefit-item {
    padding: 1rem;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    height: 100%;
}

.step-icon {
    opacity: 0.8;
}

.btn[data-category] {
    transition: all 0.2s ease;
}

.btn[data-category]:hover {
    transform: translateY(-1px);
}

.btn[data-category].active {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
}
</style>
{% endblock %}